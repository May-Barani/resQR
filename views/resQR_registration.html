<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>resQR</title>
    <link rel="stylesheet" href="resQR_registration.css" />
  </head>
  <body class="resQR-background">
    <div class="container">
      <div class="registration-heading-container">
        <div class="logo">
          <img src="resQR-logo-design.png" class="logo-size" alt="resQR-logo" />
        </div>
        <div class="registration-heading">
          <div style="text-align: center">
            <h2>resQR Registration Form</h2>
          </div>
        </div>
      </div>
      <form
        id="myForm"
        class="registrationForm"
        method="post"
        action="/process-form"
      >
        <div class="owner_details">
          <div class="registration-form-row">
            <input
              name="ownerVIN"
              type="text"
              placeholder="Enter Vehicle Identification Number (VIN)"
            />
          </div>
          <div class="registration-form-row">
            <input
              type="text"
              name="ownerFirstName"
              placeholder="Enter Owner First Name"
            />
            <input
              type="text"
              name="ownerLastName"
              placeholder="Enter Owner Last Name"
            />
          </div>
          <div class="registration-form-row">
            <input
              type="email"
              name="ownerEmailId"
              placeholder="Enter your email id"
            />
            <input
              type="tel"
              name="ownerPhoneNumber"
              placeholder="Enter your Phone Number"
            />
          </div>
          <div
           class="registration-form-gender"
          >
            <div
            class="registration-form-equal-spacing"
            >
            <div  class="registration-form-col">
              <p>Select your Birthdate</p>
              <input
              id="dob"
              type="date"
              name="ownerDateOfBirth"
              placeholder="Enter your DOB"
              style="height: 13px;margin: 0px;"
            />
            </div>
            </div>
            <div
            class="registration-form-equal-spacing"
            >
              <div class="registration-form-col">
                <p>Select your Blood Group</p>
                <select name="ownerBloodGroup" id="bloodGroup">
                  <option value="null"></option>
                  <option value="A+">A+</option>
                  <option value="A-">A-</option>
                  <option value="B+">B+</option>
                  <option value="B-">B-</option>
                  <option value="O+">O+</option>
                  <option value="O-">O-</option>
                  <option value="AB+">AB+</option>
                  <option value="AB-">AB-</option>
                </select>
              </div>
            </div>
            <div
            class="registration-form-equal-spacing"
            >
              <div class="registration-form-col">
                <p>Select your Gender</p>
                <div   class="registration-form-dob">
                  <div class="registration-form-row">
                    <input
                      style="height: 13px; margin: 3px"
                      type="radio"
                      id="male"
                      name="ownerGender"
                      value="male"
                    />
                    <p>Male</p>
                  </div>
                  <div class="registration-form-row">
                  <input
                    style="height: 13px; margin: 3px"
                    type="radio"
                    id="female"
                    name="ownerGender"
                    value="female"
                  />
                  <p>Female</p>
                </div>
              </div>
            </div>
          </div>
        </div>
<!--Dependents-->
        <div class="dependent-form">
          <h2 style="text-align: center">Dependents Details</h2>
          <form id="dependents-form">
              <div class="dependent-input">
                  <label for="add-dependents">Add Dependents:</label>
                  <select id="add-dependents" name="add-dependents">
                      <option value="yes">Yes</option>
                      <option value="no">No</option>
                  </select>
              </div>
              <div class="dependent-details">
                  <div class="dependent-input">
                      <label for="first-name">First Name:</label>
                      <input type="text" name="first-name">
                  </div>
                  <div class="dependent-input">
                      <label for="last-name">Last Name:</label>
                      <input type="text" name="last-name">
                  </div>
                  <div class="dependent-input">
                      <label for="gender">Gender:</label>
                      <select name="gender">
                          <option value="male">Male</option>
                          <option value="female">Female</option>
                          <option value="other">Other</option>
                      </select>
                  </div>
                  <div class="dependent-input">
                      <label for="birthdate">Birthdate:</label>
                      <input type="date" name="birthdate">
                  </div>
                  <div class="dependent-input">
                      <label for="email">Email:</label>
                      <input type="email" name="email">
                  </div>
                  <div class="dependent-input">
                      <label for="contact-number">Contact Number:</label>
                      <input type="tel" name="contact-number">
                  </div>
                  <div class="dependent-input">
                      <label for="blood-group">Blood Group:</label>
                      <select name="blood-group">
                          <option value="A+">A+</option>
                          <option value="B+">B+</option>
                          <option value="AB+">AB+</option>
                          <option value="O+">O+</option>
                          <option value="A-">A-</option>
                          <option value="B-">B-</option>
                          <option value="AB-">AB-</option>
                          <option value="O-">O-</option>
                      </select>
                  </div>
                  <div class="dependent-input">
                      <label for="member-type">Dependents Member Type:</label>
                      <select name="member-type">
                          <option value="family">Family</option>
                          <option value="friend">Friend</option>
                      </select>
                  </div>
                  <button type="button" class="remove-dependent">Remove Dependent</button>
              </div>
              <div class="error-message" id="error-message"></div>
              <button type="button" id="add-dependent">Add Dependent</button>
              <button type="button" id="submit-form">Submit</button>
          </form>
      </div>

        <div style="display: flex;flex-direction: row-reverse;">
          <button id="resQR_Form_details" type="submit" onclick="submitForm()"style="width: 20%;">
            Next
          </button>
        </div>
      </form>
      <!-- <div id="imgBox">
         <img src="" id="qrImage" />
         </div> -->
      <!-- <button onclick="generateQR()">Generate QR code</button> -->
    </div>
    <script>
    //   let imgBox = document.getElementById("imgBox");
    //   let qrImage = document.getElementById("qrImage");
    //   let qrText = document.getElementById("qrText");


        const addDependentsSelect = document.getElementById('add-dependents');
        const addDependentButton = document.getElementById('add-dependent');
        const submitButton = document.getElementById('submit-form');
        const dependentsForm = document.getElementById('dependents-form');
        const errorMessage = document.getElementById('error-message');
        let dependentCount = 0;
        let formData = [];

        // Initialize the form as hidden if "Add Dependents" is set to "No"
        if (addDependentsSelect.value === "no") {
            dependentsForm.classList.add("disabled-form");
        }

        // Event listener for the "Add Dependents" select
        addDependentsSelect.addEventListener('change', () => {
            if (addDependentsSelect.value === "yes") {
                dependentsForm.classList.remove("disabled-form");
                resetDependentForm();
            } else {
                dependentsForm.classList.add("disabled-form");
            }
        });

        // Event listener for the "Add Dependent" button
        addDependentButton.addEventListener('click', () => {
            if (dependentCount < 5) {
                const dependentDetails = dependentsForm.querySelector('.dependent-details');
                const newDependentDetails = dependentDetails.cloneNode(true);
                resetDependentForm(newDependentDetails);
                dependentsForm.appendChild(newDependentDetails);
                dependentCount++;
            } else {
                errorMessage.textContent = "You can't add more than 5 dependents.";
            }
        });

        // Event listener for removing dependents
        dependentsForm.addEventListener('click', (event) => {
            if (event.target.classList.contains('remove-dependent')) {
                event.target.parentElement.remove();
                dependentCount--;
                errorMessage.textContent = ""; // Clear error message
            }
        });

        // Reset a dependent form to clear input values
        function resetDependentForm(form) {
            if (!form) {
                form = dependentsForm.querySelector('.dependent-details');
            }
            const inputs = form.querySelectorAll('input, select');
            inputs.forEach((input) => {
                input.value = '';
            });
        }

        // Event listener for the "Submit" button
        submitButton.addEventListener('click', () => {
            const dependentDetails = document.querySelectorAll('.dependent-details');
            formData = [];

            dependentDetails.forEach((dependent) => {
                const elements = dependent.querySelectorAll('[name]');
                const dependentData = {};

                elements.forEach((element) => {
                    dependentData[element.name] = element.value;
                });

                formData.push(dependentData);
            });

            const jsonData = JSON.stringify(formData, null, 2);
            console.log(jsonData);
        });

      function generateQR(data) {
        try {
          const { text } = data;
          if (!text) {
            return res
              .status(400)
              .json({ error: "Missing 'text' key in the JSON data." });
          }

          QRCode.toDataURL(text, (err, url) => {
            if (err) {
              return res.status(500).json({ error: err.message });
            }
            res.json({ qrCodeUrl: url });
          });
        } catch (err) {
          res.status(500).json({ error: err.message });
        }        
      }

      function submitForm() {
      
        document.addEventListener("DOMContentLoaded", function () {
          // Attach a submit event handler to the form
          document
            .getElementById("myForm")
            .addEventListener("submit", function (event) {
              event.preventDefault(); // Prevent the default form submission

              // Get form elements by their name attribute
              let ownerFirstName = this.elements["ownerFirstName"].value;
              let ownerLastName = this.elements["ownerLastName"].value;
              let ownerEmailId = this.elements["ownerEmailId"].value;
              let ownerPhoneNumber = this.elements["ownerPhoneNumber"].value;
              let ownerDateOfBirth = this.elements["ownerDateOfBirth"].value;
              let ownerGender = this.elements["ownerDateOfBirth"].value;
              let ownerBloodGroup = this.elements["ownerDateOfBirth"].value;

              // Create a JSON object to store the form data
              let formData = {
                ownerFirstName: ownerFirstName,
                ownerLastName: ownerLastName,
                ownerEmailId: ownerEmailId,
                ownerPhoneNumber: ownerPhoneNumber,
                ownerDateOfBirth: ownerDateOfBirth,
                ownerGender: ownerGender,
                ownerBloodGroup: ownerBloodGroup,
              };

              fetch("/process-form", {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify(formData),
              })
                .then((response) => response.json())
                .then((data) => {
                
                });
            });
        });
      }
    </script>
  </body>
</html>
